<!--#include "./common/head.html"-->
        <div class="container">
            <section>
                <h2>组件管理</h2>
                <ul id="J_list" class="mod-list">
                	
                </ul>
                <a href="#" class="btn btn-small btn-success J_addwidget">创建组件</a>
            </section>

        </div>
        <!-- /container -->
        <!-- 编辑页面信息的表单 -->
        <div class="modal hide fade" id="J_addForm">
            <form class="form-horizontal J_modForm" style="margin:0">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h3>创建组件</h3>
                </div>
                <div class="modal-body">

                    <div class="control-group">
                        <label class="control-label">模块名（英文）：</label>
                        <div class="controls">
                            <input type="text" value="" name="name" placeholder="模块名也将做为文件夹名">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">模块描述：</label>
                        <div class="controls">
                            <input type="text" name="description" placeholder="填写模块的中文名或描述">
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">其它资源：</label>
                        <div class="controls">
                            <label class="checkbox inline">
                                <input type="checkbox" name="addcss" value="true" checked="checked">
                                CSS </label>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary J_save">
                        创建
                    </button>
                </div>
            </form>
        </div>

        <div class="modal hide fade" id="J_addInfo">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h3>创建页面</h3>
            </div>
            <div class="modal-body">
                <p class="J_infoWrap">

                </p>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn" data-dismiss="modal" aria-hidden="true">关闭</a>
            </div>
        </div>
        <script type="text/tmpl" id="T_widget">
            <li data-name="${name}">${name}:${description} <a href="#" class="btn btn-small btn-danger J_delwidget">删除</a></li>
        </script>
        <script type="text/javascript">
            $(function() {
                //获取页面
                $.get("/getwidgets", function(resp) {
                    var d = resp.data;
                   createList(d)
                }, "json");

                //点击创建模块按钮弹出表单浮层
                $("body").on("click", ".J_addwidget", function(e) {
                    var form = $(".J_modForm");
                    form[0].reset();
                    e.preventDefault();
                    $("#J_addForm").modal("show");
                });

                //保存模块数据
                $("#J_addForm").on("click", ".J_save", function(e) {
                    e.preventDefault();
                    var form = $(".J_modForm"), texts = form.find("input[type='text']"), checkbox = form.find("input[type='checkbox']"), formData = {};
                    texts.each(function() {
                        var text = $(this), name = text.attr("name");
                        formData[name] = text.val();
                    });
                    checkbox.each(function() {
                        var box = $(this), name = box.attr("name");
                        if (box[0].checked) {
                            formData[name] = true;
                        }else{
                            formData[name] = false;
                        }
                    });
                    $("#J_addForm").modal("hide");
                    $("#J_addInfo").modal("show");
                    $(".J_infoWrap").html("正在创建...");
                    $.get("/savewidget", formData, function(resp) {
                        var d = resp.data;
                        if (d.fail) {
                            $(".J_infoWrap").html("创建失败：" + d.msg);
                            return;
                        }
                        var html = '', i;
                        for ( i = 0; i < d.length; i++) {
                            html += '<h5>' + d[i].action + '</h5>' + d[i].content;
                        }
                        $(".J_infoWrap").html(html);
                        createCell(formData);
                    }, "json");
                });

                $("body").on("click", ".J_delwidget", function(e) {
                    e.preventDefault();
                    var step1 = arguments.callee, btn = e.currentTarget;
                    $(btn).removeClass("J_delwidget").addClass("J_confirmdel").text("再次点击确定删除");
                    setTimeout(function() {
                        $(btn).addClass("J_delwidget").removeClass("J_confirmdel").text("删除");
                    }, 2000);
                });

                $("body").on("click", ".J_confirmdel", function(e) {
                    e.preventDefault();
                    var li = $(e.currentTarget).parents("li");
                    $.get("/delwidget", {
                        name : li.attr("data-name")
                    }, function(d) {
                        li.remove();
                    }, "json");
                });
                //渲染列表
                function createList(data){
                    var tmpl = $("#T_widget").html();
                    $.each(data,function(i,val){
                        $("#J_list").append($(juicer(tmpl,val)));
                    })
                }
                
                
                //创建表格html
                function createCell(data) {
                    var tmpl = $("#T_widget").html();
                    $("#J_list").append($(juicer(tmpl,data)));
                }

            });
        </script>
<!--#include "./common/foot.html"-->