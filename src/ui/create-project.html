<!--#include "./common/head.html"-->
<div class="container">
   
    <section class="well">
        <h2>填写（编辑）项目信息<span style="margin-left:30px;" class="label label-warning"> 项目创建好之后就只能修改项目名称，修改其它设置会导致已有项目内容不可用 </span></h2>
        
        <form class="form-horizontal J_projectForm">
            <div class="row-fluid">
                <div class="span9">
                    <div class="white-well">
                        <div class="control-group">
                            <label class="control-label">项目文件夹：</label>
                            <div class="controls">
                                <input type="text" class="span5" value="" name="name" disabled="disabled">
                                <a href="build-manager.html" class="btn btn-success">进入打包管理界面</a>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">CDN路径：</label>
                            <div class="controls">
                                <input type="text" class="span5" value="" name="cdnPath" placeholder="http://a.tbcdn.cn/apps">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">项目名称：</label>
                            <div class="controls">
                                <input type="text" name="description" placeholder="填写项目的中文名">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">选择JS库：</label>
                            <div class="controls">
                                <label class="checkbox inline">
                                    <input type="checkbox" name="lib" value="KISSY">
                                    KISSY </label>
                                <label class="checkbox inline">
                                    <input type="checkbox" name="lib" value="JQUERY">
                                    JQUERY </label>
                                <label class="checkbox inline">
                                    <input type="checkbox" name="lib" value="YUI">
                                    YUI </label>
                                <label class="checkbox inline">
                                    <input type="checkbox" name="lib" value="ZEPTO">
                                    ZEPTO </label>
                                <label class="checkbox inline">
                                    <input type="checkbox" name="lib" value="SEAJS">
                                    SEAJS </label>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">CSS前缀：</label>
                            <div class="controls">
                                <input type="text" name="cssns" placeholder="两个字母加上'-',如：'te-'">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">JS命名空间：</label>
                            <div class="controls">
                                <input type="text" name="jsns" placeholder="默认与项目文件夹名相同">
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">编码：</label>
                            <div class="controls">
                                <label class="checkbox inline">
                                    <input type="radio" name="charset" value="gbk" checked="checked">
                                    gbk</label>
                                <label class="checkbox inline">
                                    <input type="radio" name="charset" value="utf-8">
                                    utf-8</label>
                            </div>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Hosts配置：</label>
                            <div class="controls">
                                <textarea name="hosts" style="width:400px" rows="10" cols="80" placeholder="127.0.0.1 a.tbcdn.cn"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary J_save">
                    保存
                </button>
            </div>
        </form>
    </section>
</div>
<!-- /container -->
<div class="modal hide fade" id="J_saveInfo">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            &times;
        </button>
        <h3>项目创建成功，进行了下列操作</h3>
    </div>
    <div class="modal-body">
        <p>
            <div class="J_progressInfo"></div>
        </p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn" data-dismiss="modal" aria-hidden="true">关闭</a>
    </div>
</div>
<script type="text/javascript">
    $(function() {
        //获取当前项目状态,如果是有数据的话给表单赋初值
        $.get("/projectinfo", function(d) {
            var form = $(".J_projectForm"), val, input, i;
            for (k in d) {
                val = d[k];
                if (k != "state") {
                    if ($.isArray(val)) {
                        //如果数据是数组，则按checkbox处理
                        form.find('input[name="' + k + '"]').each(function() {
                            input = $(this);
                            for ( i = 0; i < val.length; i++) {
                                if (input.val() == val[i]) {
                                    input[0].checked = true;
                                }
                            }
                        });
                    } else {
                        //不是数组的做赋值操作
                        form.find('input[name="' + k + '"]').val(val);
                        form.find('textarea[name="'+ k + '"]').val(val);
                    }
                }
            }
        }, "json");
        $(".J_save").click(function(e) {
            e.preventDefault();
            var form = $(".J_projectForm"), texts = form.find("input[type='text']"), checkbox = form.find("input[type='checkbox']"), radios = form.find("input[type='radio']"), formData = {};
            var areas = form.find('textarea');
            texts.each(function() {
                var text = $(this), name = text.attr("name");
                formData[name] = text.val();
            });
            checkbox.each(function() {
                var box = $(this), name = box.attr("name");
                if (box[0].checked) {
                    if (!formData[name] || !$.isArray(formData[name])) {
                        formData[name] = [];
                    }
                    formData[name].push(box.val());
                }
            });
            radios.each(function() {
                var box = $(this), name = box.attr("name");
                if (box[0].checked) {
                    if (!formData[name] || !$.isArray(formData[name])) {
                        formData[name] = [];
                    }
                    formData[name].push(box.val());
                }
                console.log(box.val());
            });
            areas.each(function(){
                var text = $(this), name = text.attr("name");
                formData[name] = text.val();
            });

            $.get("/saveproject", formData, function(resp) {
                var html = '', i;
                var d = resp.data;
                for ( i = 0; i < d.length; i++) {
                    html += '<h5>' + d[i].action + '</h5>' + d[i].content;
                }
                $(".J_progressInfo").html(html);
                $("#J_saveInfo").modal("show");
            }, "json");

        });
        //点击创建模块按钮弹出表单浮层
        $("body").on("click", ".J_addcoremod", function(e) {
            e.preventDefault();
            $.get("/addcoremod", function(resp) {
                location.href = "mod-manager.html";
            }, "json");
        });
    });

</script>
<!--#include "./common/foot.html"-->
